<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Konarak Food & Beverages — HRMS (Frontend Demo)</title>

  <!-- External libraries for later parts (SheetJS, html2canvas, jsPDF will be used later) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ---------- CORE THEME (dark-first) ---------- */
    :root{
      --bg-1: #071026; --bg-2: #0b1830;
      --header: #061426; --card: #071133; --muted: #99a7c0; --accent: #0ea5e9;
      --accent-strong: #00bfff; --text: #e6eef8;
      --danger: #ef4444;
      --glass: rgba(255,255,255,0.02);
    }
    [data-theme="light"]{
      --bg-1:#eef2f3; --bg-2:#d9e4f5; --header:#1f2937; --card:#fff; --muted:#6b7280; --accent:#2563eb; --text:#0f172a; --glass: rgba(0,0,0,0.03);
    }
    html,body{height:100%;}
    body{
      margin:0; font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg,var(--bg-1),var(--bg-2));
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .header{
      height:64px; background:var(--header); color:var(--text);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 20px; box-shadow: 0 6px 22px rgba(0,0,0,0.45); position:sticky; top:0; z-index:60;
    }
    .logo-row{display:flex;gap:12px;align-items:center;}
    .logo-image{width:44px;height:44px;object-fit:contain;border-radius:8px;background:var(--glass);padding:6px;}
    .app-title{font-weight:800;font-size:18px;}
    .header-right{display:flex;gap:12px;align-items:center;}

    .menu-icon{font-size:26px;cursor:pointer; user-select:none;}

    /* Side menu */
    .side-menu{
      position:fixed; top:0; left:-320px; width:320px; height:100vh; padding-top:64px;
      background: linear-gradient(180deg, rgba(2,6,23,0.95), rgba(6,10,30,0.95));
      color:var(--muted); transition: left 220ms ease; z-index:70; overflow:auto;
    }
    .side-menu a{display:block;padding:14px 20px;color:var(--muted);text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.02);}
    .side-menu a:hover{background:rgba(255,255,255,0.02); color:var(--text);}

    .menu-backdrop{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:65;}

    /* App area */
    .app{ padding:28px; margin-left:0; transition: margin-left 220ms ease; min-height:calc(100vh - 64px); }
    .container{ max-width:1180px; margin:0 auto; }

    /* Card grid (home) */
    .grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:22px; margin-top:12px; }

    .card{
      background:var(--card); border-radius:14px; padding:26px 18px; text-align:center; box-shadow: 0 8px 20px rgba(0,0,0,0.18);
      cursor:pointer; transition: transform 180ms ease, box-shadow 180ms ease; overflow:hidden; position:relative;
    }
    .card:hover{ transform:translateY(-6px); box-shadow: 0 18px 40px rgba(0,0,0,0.28); }
    .card .icon{ width:56px;height:56px;margin:0 auto 12px; opacity:0.95; filter:brightness(1.1); }
    .card .label{ font-weight:800; font-size:16px; color:var(--text); }

    /* sections + forms */
    .section{ background:var(--card); border-radius:12px; padding:18px; margin-bottom:18px; box-shadow: 0 8px 18px rgba(0,0,0,0.12); }
    .section-title{ font-weight:800; font-size:16px; margin-bottom:6px; color:var(--accent-strong); }
    .row{ display:flex; gap:12px; align-items:center; }
    .col{ flex:1; }

    .field{ width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--text); }
    .field.small{ padding:8px; font-size:13px; }

    .btn{ padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn.primary{ background:var(--accent-strong); color:#002033; }
    .btn.ghost{ background:transparent; color:var(--text); border:1px solid rgba(255,255,255,0.04); }

    table{ width:100%; border-collapse:collapse; margin-top:8px; }
    th,td{ text-align:left; padding:10px; border-bottom:1px solid rgba(255,255,255,0.03); font-size:13px; color:var(--text); }
    th{ font-weight:700; color:white; background:linear-gradient(90deg, rgba(10,20,40,0.95), rgba(5,15,30,0.9)); }

    .muted{ color:var(--muted); font-size:13px; }
    .mini{ font-size:12px; color:var(--muted); }

    /* login modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:120; }
    .modal{ width:420px; background:var(--card); border-radius:12px; padding:18px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }

    /* responsive */
    @media(max-width:900px){ .row{ flex-direction:column; } .side-menu{ width:260px; } }

  </style>
</head>
<body data-theme="dark">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-row">
      <img src="logo.png" alt="Konarak Logo" class="logo-image" onerror="this.style.display='none'">
      <div>
        <div class="app-title">Konarak Food & Beverages — HRMS (Frontend)</div>
        <div class="mini muted">Local demo — secure your production deployment</div>
      </div>
    </div>

    <div class="header-right">
      <div class="muted" id="headerUser">Not signed in</div>
      <div class="menu-icon" onclick="toggleMenu()">☰</div>
    </div>
  </div>

  <!-- SIDE MENU -->
  <nav id="sideMenu" class="side-menu" aria-hidden="true">
    <a href="#" onclick="route('home')">Home</a>
    <a href="#" onclick="route('dashboard')">Dashboard</a>
    <a href="#" onclick="route('employees')">Employee Central</a>
    <a href="#" onclick="route('recruitment')">Recruitment</a>
    <a href="#" onclick="route('attendance')">Attendance</a>
    <a href="#" onclick="route('leave')">Leave Management</a>
    <a href="#" onclick="route('payroll')">Payroll</a>
    <a href="#" onclick="route('documents')">Documents</a>
    <a href="#" onclick="route('performance')">Performance</a>
    <a href="#" onclick="route('idcards')">ID Cards</a>
    <a href="#" onclick="route('letters')">Letters & Templates</a>
    <a href="#" onclick="route('reports')">Reports</a>
    <a href="#" onclick="route('settings')">Settings</a>
    <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:8px 0;">
    <a href="#" onclick="signOut()">Sign out</a>
  </nav>
  <div id="menuBackdrop" class="menu-backdrop" onclick="toggleMenu()"></div>

  <!-- APP -->
  <div class="app">
    <div class="container" id="appContainer">

      <!-- HOME VIEW -->
      <div id="homeView">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-size:20px;font-weight:800">Welcome to Konarak HRMS (Frontend)</div>
            <div class="muted">Dark theme enabled. All data stored locally (localStorage).</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button class="btn ghost" onclick="openLogin()">Sign in</button>
            <button class="btn ghost" onclick="downloadBackup()">Download Backup</button>
            <label style="display:inline-block;">
              <input type="file" id="uploadBackup" class="mini" style="display:none" onchange="importBackup(event)">
              <button class="btn ghost" onclick="document.getElementById('uploadBackup').click()">Upload Backup</button>
            </label>
          </div>
        </div>

        <div class="grid" style="margin-top:18px;">
          <div class="card" onclick="route('dashboard')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/dashboard.png" alt="">
            <div class="label">Dashboard</div>
          </div>
          <div class="card" onclick="route('employees')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/user-group-man-man.png" alt="">
            <div class="label">Employee Central</div>
          </div>
          <div class="card" onclick="route('recruitment')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/resume.png" alt="">
            <div class="label">Recruitment</div>
          </div>
          <div class="card" onclick="route('attendance')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/clock.png" alt="">
            <div class="label">Attendance</div>
          </div>
          <div class="card" onclick="route('payroll')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/money-bag.png" alt="">
            <div class="label">Payroll</div>
          </div>
          <div class="card" onclick="route('documents')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/document--v1.png" alt="">
            <div class="label">Documents</div>
          </div>
          <div class="card" onclick="route('idcards')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/id-card.png" alt="">
            <div class="label">ID Cards</div>
          </div>
          <div class="card" onclick="route('letters')">
            <img class="icon" src="https://img.icons8.com/ios-filled/100/ffffff/new-post.png" alt="">
            <div class="label">Letters & Templates</div>
          </div>
        </div>
      </div>

      <!-- PLACEHOLDER VIEWS (will be replaced as part 2+) -->
      <div id="dashboardView" class="section" style="display:none;">
        <div class="section-title">Dashboard</div>
        <div class="row" style="margin-top:8px;">
          <div class="col section">
            <div class="mini">Total employees</div>
            <div style="font-weight:900;font-size:22px;" id="kpiEmployees">0</div>
            <div class="mini">Use Employee Central to add new employees</div>
          </div>
          <div class="col section">
            <div class="mini">Pending leaves</div>
            <div style="font-weight:900;font-size:22px;" id="kpiLeaves">0</div>
            <div class="mini">Leave management will show approvals</div>
          </div>
          <div class="col section">
            <div class="mini">Attendance logs</div>
            <div style="font-weight:900;font-size:22px;" id="kpiAttendance">0</div>
            <div class="mini">Attendance module will show IN/OUT</div>
          </div>
        </div>

        <div style="margin-top:14px;" id="recentActivity" class="small muted">No activity yet</div>
      </div>

      <!-- Employee central simple placeholder -->
      <div id="employeesView" style="display:none;">
        <div class="section">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div class="section-title">Employee Central</div>
              <div class="mini muted">Complete employee master will be here (Part 2)</div>
            </div>
            <div style="display:flex;gap:8px;">
              <button class="btn primary" onclick="route('recruitment')">Open Recruitment</button>
            </div>
          </div>
          <div style="margin-top:12px;" id="empListPlaceholder" class="section">Employee list will appear here after Part 2 is added.</div>
        </div>
      </div>

      <!-- Recruitment placeholder -->
      <div id="recruitmentView" style="display:none;">
        <div class="section">
          <div class="section-title">Recruitment</div>
          <div class="mini muted">Recruitment module coming next (Part 3)</div>
        </div>
      </div>

      <!-- Attendance placeholder -->
      <div id="attendanceView" style="display:none;">
        <div class="section">
          <div class="section-title">Attendance</div>
          <div class="mini muted">Attendance module coming next (Part 4). Methods: Web IN/OUT + Auto + Manual</div>
        </div>
      </div>

      <!-- Payroll placeholder -->
      <div id="payrollView" style="display:none;">
        <div class="section">
          <div class="section-title">Payroll</div>
          <div class="mini muted">Payroll module coming next (Part 6)</div>
        </div>
      </div>

      <!-- Documents placeholder -->
      <div id="documentsView" style="display:none;">
        <div class="section">
          <div class="section-title">Documents</div>
          <div class="mini muted">Documents module coming next (Part 5)</div>
        </div>
      </div>

      <!-- ID cards placeholder -->
      <div id="idcardsView" style="display:none;">
        <div class="section">
          <div class="section-title">ID Cards</div>
          <div class="mini muted">ID card generator coming in Part 8 (vertical premium design)</div>
        </div>
      </div>

      <!-- Letters placeholder -->
      <div id="lettersView" style="display:none;">
        <div class="section">
          <div class="section-title">Letters & Templates</div>
          <div class="mini muted">Offer/hike/experience etc. will be included in Part 7</div>
        </div>
      </div>

      <!-- Reports placeholder -->
      <div id="reportsView" style="display:none;">
        <div class="section">
          <div class="section-title">Reports</div>
          <div class="mini muted">Reports & exports in Part 9</div>
        </div>
      </div>

      <!-- Settings placeholder -->
      <div id="settingsView" style="display:none;">
        <div class="section">
          <div class="section-title">Settings</div>
          <div style="display:flex;gap:12px;align-items:center;">
            <div>
              <div class="mini muted">Theme</div>
              <select id="themeSelect" class="field small" onchange="applyThemeLocal()">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="purple">Purple Accent</option>
                <option value="blue">Blue Accent</option>
              </select>
            </div>
            <div>
              <div class="mini muted">Admin account</div>
              <div class="mini">Admin: <strong>konarakfb@gmail.com</strong></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- LOGIN MODAL (reusable) -->
  <div id="loginModal" style="display:none;" class="modal-backdrop">
    <div class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:800">Sign in</div>
        <div class="mini muted">Konarak HRMS</div>
      </div>

      <div style="margin-top:12px;">
        <div class="mini muted">Sign in as</div>
        <select id="loginRole" class="field small" style="margin-top:6px;">
          <option value="admin">Admin</option>
          <option value="employee">Employee</option>
        </select>

        <div id="adminLoginFields" style="margin-top:8px;">
          <input id="adminEmail" class="field small" placeholder="Email" value="konarakfb@gmail.com">
          <input id="adminPass" type="password" class="field small" placeholder="Password" value="Money@123">
        </div>

        <div id="empLoginFields" style="display:none;margin-top:8px;">
          <input id="empCode" class="field small" placeholder="Employee Code (e.g. EMP1001)">
          <input id="empPass" type="password" class="field small" placeholder="Password">
        </div>

        <div style="display:flex;gap:8px;margin-top:10px;">
          <button class="btn primary" onclick="performLogin()">Sign in</button>
          <button class="btn ghost" onclick="closeLogin()">Cancel</button>
        </div>

        <div class="mini muted" style="margin-top:8px;">Admin credentials: konarakfb@gmail.com / Money@123</div>
      </div>
    </div>
  </div>

<script>
/* ===========================
   Part 1: Core framework JS
   STORE structure and helpers
   =========================== */

const STORE_KEY = 'konarak_sf_complete_v1';

/* Default store template (safe seed) */
const DEFAULT_STORE = {
  meta: {
    createdAt: new Date().toISOString(),
    theme: 'dark',
    admins: [
      // seeded admin (your requested credentials)
      { email: 'konarakfb@gmail.com', password: 'Money@123', name: 'Konarak Admin', role: 'superadmin' }
    ]
  },
  employees: [],
  candidates: [],
  attendance: [],
  leaves: [],
  payroll: [],
  documents: [],
  goals: [],
  logs: [] // activity logs
};

let STORE = {};

/* Utility: safe load/save */
function loadStore(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw){ STORE = DEFAULT_STORE; saveStore(); return; }
    STORE = JSON.parse(raw);
    // ensure keys exist
    for(const k of Object.keys(DEFAULT_STORE)){
      if(typeof STORE[k] === 'undefined') STORE[k] = DEFAULT_STORE[k];
    }
  } catch(e){
    console.error('loadStore error', e);
    STORE = DEFAULT_STORE;
    saveStore();
  }
}
function saveStore(){
  localStorage.setItem(STORE_KEY, JSON.stringify(STORE));
}

/* UID generator */
function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }

/* File to base64 helper (returns dataURL) */
function fileToBase64(file){ return new Promise((res,rej)=>{ const fr = new FileReader(); fr.onload = ()=> res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); }); }

/* Escape for HTML insertion */
function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"'`=\/]/g, function (c) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[c]; }); }

/* Logging helper */
function logActivity(text){
  STORE.logs = STORE.logs || [];
  STORE.logs.push({ text, time: new Date().toISOString() });
  if(STORE.logs.length > 5000) STORE.logs.shift();
  saveStore();
}

/* Initialize */
loadStore();

/* ===========================
   Theme engine
   =========================== */
function applyThemeLocal(){
  const sel = document.getElementById('themeSelect');
  const val = sel ? sel.value : (STORE.meta && STORE.meta.theme ? STORE.meta.theme : 'dark');
  if(val === 'light'){ document.body.setAttribute('data-theme','light'); STORE.meta.theme = 'light'; document.documentElement.style.setProperty('--accent-strong','#2563eb'); }
  else if(val === 'purple'){ document.body.setAttribute('data-theme','dark'); STORE.meta.theme = 'purple'; document.documentElement.style.setProperty('--accent-strong','#7c3aed'); }
  else if(val === 'blue'){ document.body.setAttribute('data-theme','dark'); STORE.meta.theme = 'blue'; document.documentElement.style.setProperty('--accent-strong','#0ea5e9'); }
  else { document.body.setAttribute('data-theme','dark'); STORE.meta.theme = 'dark'; document.documentElement.style.setProperty('--accent-strong','#0ea5e9'); }
  saveStore();
}
function applyThemeInitial(){
  const t = (STORE.meta && STORE.meta.theme) || 'dark';
  const sel = document.getElementById('themeSelect');
  if(sel) sel.value = t;
  applyThemeLocal();
}
applyThemeInitial();

/* ===========================
   Navigation + menu
   =========================== */
function toggleMenu(){
  const menu = document.getElementById('sideMenu');
  const backdrop = document.getElementById('menuBackdrop');
  if(menu.style.left === '0px'){ menu.style.left = '-320px'; backdrop.style.display = 'none'; }
  else { menu.style.left = '0px'; backdrop.style.display = 'block'; }
}
function route(view){
  // hide menu
  document.getElementById('sideMenu').style.left = '-320px';
  document.getElementById('menuBackdrop').style.display = 'none';
  // hide all views inside appContainer (direct children)
  const container = document.getElementById('appContainer');
  Array.from(container.children).forEach(ch => ch.style.display = 'none');

  // map view to id
  const map = {
    home: 'homeView',
    dashboard: 'dashboardView',
    employees: 'employeesView',
    recruitment: 'recruitmentView',
    attendance: 'attendanceView',
    leave: 'leaveView',
    payroll: 'payrollView',
    documents: 'documentsView',
    performance: 'performanceView',
    idcards: 'idcardsView',
    letters: 'lettersView',
    reports: 'reportsView',
    settings: 'settingsView'
  };
  const id = map[view] || 'homeView';
  const el = document.getElementById(id);
  if(el) el.style.display = 'block';
  // call renderers for specific pages (if available)
  try{ if(view === 'dashboard') renderDashboard(); if(view === 'employees') renderEmployeesShort(); } catch(e){ console.warn('route render error', e); }
  window.scrollTo({top:0, behavior:'smooth'});
}

/* ===========================
   AUTH: Login / session
   - Front-end session only
   - Admin and employee
   =========================== */

let SESSION = { user: null, role: null }; // role: admin | employee

function openLogin(){
  document.getElementById('loginModal').style.display = 'flex';
  // reset fields
  document.getElementById('loginRole').value = 'admin';
  document.getElementById('adminLoginFields').style.display = 'block';
  document.getElementById('empLoginFields').style.display = 'none';
}
function closeLogin(){ document.getElementById('loginModal').style.display = 'none'; }
document.getElementById('loginRole').addEventListener('change', function(e){
  const v = e.target.value;
  document.getElementById('adminLoginFields').style.display = v === 'admin' ? 'block' : 'none';
  document.getElementById('empLoginFields').style.display = v === 'employee' ? 'block' : 'none';
});

/* Perform login */
function performLogin(){
  const role = document.getElementById('loginRole').value;
  if(role === 'admin'){
    const email = (document.getElementById('adminEmail').value || '').trim();
    const pass = (document.getElementById('adminPass').value || '').trim();
    const found = (STORE.meta && STORE.meta.admins || []).find(a => a.email === email && a.password === pass);
    if(!found){ alert('Invalid admin credentials'); return; }
    SESSION = { user: found, role: 'admin' };
    closeLogin(); onSignedIn();
  } else {
    const code = (document.getElementById('empCode').value || '').trim();
    const pass = (document.getElementById('empPass').value || '').trim();
    if(!code || !pass){ alert('Employee code and password required'); return; }
    const emp = STORE.employees.find(e => (e.code === code || e.email === code) && e.password === pass);
    if(!emp){ alert('Invalid employee credentials'); return; }
    SESSION = { user: emp, role: 'employee' };
    closeLogin(); onSignedIn();
  }
}

/* Sign out */
function signOut(){
  SESSION = { user: null, role: null };
  document.getElementById('headerUser').innerText = 'Not signed in';
  route('home');
}

/* On sign-in */
function onSignedIn(){
  const role = SESSION.role;
  const name = SESSION.user && (SESSION.user.name || SESSION.user.fullname || SESSION.user.email) || 'user';
  document.getElementById('headerUser').innerText = `${name} (${role})`;
  logActivity(`${name} signed in as ${role}`);
  if(role === 'admin'){ route('dashboard'); }
  else { route('dashboard'); showEmployeeDashboard(); }
}

/* If a page needs to show employee-specific views, use this helper */
function requireAdmin(actionIfOk){
  if(SESSION.role !== 'admin') { alert('Admin access required'); return; }
  actionIfOk();
}

/* ===========================
   Simple UI renderers for Part1
   (will be expanded in later parts)
   =========================== */

function renderDashboard(){
  document.getElementById('kpiEmployees').innerText = (STORE.employees || []).length;
  document.getElementById('kpiLeaves').innerText = (STORE.leaves || []).filter(l=>l.status==='pending').length;
  document.getElementById('kpiAttendance').innerText = (STORE.attendance || []).length;
  // recent activity
  const recent = (STORE.logs || []).slice(-10).reverse();
  const out = recent.map(r => `<div class="mini" style="margin-bottom:6px">${escapeHtml(new Date(r.time).toLocaleString())} — ${escapeHtml(r.text)}</div>`).join('') || '<div class="mini muted">No recent activity</div>';
  document.getElementById('recentActivity').innerHTML = out;
}

/* Short employees render used on dashboard route */
function renderEmployeesShort(){
  const el = document.getElementById('empListPlaceholder');
  if(!el) return;
  if((STORE.employees||[]).length === 0) { el.innerHTML = '<div class="mini muted">No employees yet. Use Recruitment to add candidates and hire.</div>'; return; }
  const rows = STORE.employees.map(e => `<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.02)"><div><strong>${escapeHtml(e.fullname)}</strong><div class="mini muted">${escapeHtml(e.designation||'')} — ${escapeHtml(e.department||'')}</div></div><div class="mini muted">${escapeHtml(e.code||'')}</div></div>`).join('');
  el.innerHTML = rows;
}

/* Employee dashboard view for employees after login (basic) */
function showEmployeeDashboard(){
  // Ensure employee logged in
  if(!SESSION || SESSION.role !== 'employee') return;
  route('dashboard');
  // Add a custom welcome message for employee
  document.getElementById('recentActivity').innerHTML = `<div class="mini">Welcome ${escapeHtml(SESSION.user.fullname || SESSION.user.email)}. Use the left menu to view your data.</div>`;
}

/* ===========================
   Backup / Restore (single JSON)
   =========================== */
function downloadBackup(){
  const data = JSON.stringify(STORE, null, 2);
  const a = document.createElement('a');
  a.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(data);
  a.download = `konarak_hrms_backup_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'_')}.json`;
  a.click();
  logActivity('Downloaded backup');
}
function importBackup(e){
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = () => {
    try{
      const parsed = JSON.parse(r.result);
      // Very small validation
      if(!parsed || typeof parsed !== 'object' || !parsed.meta) return alert('Invalid backup file');
      if(!confirm('Import backup will overwrite current local data. Continue?')) return;
      STORE = parsed;
      saveStore();
      renderDashboard();
      alert('Backup imported successfully.');
      logActivity('Imported backup');
    } catch(err){ alert('Invalid JSON file'); }
  };
  r.readAsText(f);
}

/* ===========================
   Prevent duplicate hires (recruitment safety)
   - Example usage in recruitment module (Part 3)
   =========================== */
function isDuplicateCandidate(candidate){
  // crude duplicate check: same email or phone or name+source
  const c = (STORE.candidates || []).find(x => (x.email && x.email === candidate.email) || (x.phone && x.phone === candidate.phone));
  if(c) return true;
  // also check employees
  const e = (STORE.employees || []).find(x => (x.email && x.email === candidate.email) || (x.phone && x.phone === candidate.phone));
  if(e) return true;
  return false;
}

/* ===========================
   Helper: seed sample data (for testing) - only when store empty and on admin action
   =========================== */
function seedDemoData(){
  if((STORE.employees||[]).length>0) { alert('Store already contains employees'); return; }
  // create 6 demo employees with passwords
  const demo = [
    {fullname:'Rahul Kumar', code:'EMP1001', email:'rahul@example.com', phone:'9876500011', department:'Operations', designation:'Manager', basic:30000},
    {fullname:'Asha Rani', code:'EMP1002', email:'asha@example.com', phone:'9876500022', department:'Sales', designation:'Executive', basic:22000},
    {fullname:'Siva Prasad', code:'EMP1003', email:'siva@example.com', phone:'9876500033', department:'Production', designation:'Supervisor', basic:25000},
    {fullname:'Maya Singh', code:'EMP1004', email:'maya@example.com', phone:'9876500044', department:'HR', designation:'HR Executive', basic:24000},
    {fullname:'Vikram Rao', code:'EMP1005', email:'vikram@example.com', phone:'9876500055', department:'Logistics', designation:'Lead', basic:26000},
    {fullname:'Neha Gupta', code:'EMP1006', email:'neha@example.com', phone:'9876500066', department:'Finance', designation:'Accountant', basic:27000}
  ];
  demo.forEach(d=>{
    const pwd = 'Welcome@' + Math.floor(Math.random()*900 + 100);
    const e = {...d, id: uid('emp'), password: pwd, photo:null, docs: [], doj: new Date().toISOString().slice(0,10), hra: Math.round(d.basic*0.2)};
    STORE.employees.push(e);
    logActivity(`Seed employee ${e.fullname} created (pwd:${pwd})`);
  });
  saveStore();
  alert('Demo employees seeded. Use Employee Central to see details. Default passwords created and logged to activity.');
  renderEmployeesShort();
}

/* Expose seed function to admin in console */
window.seedDemoData = seedDemoData;

/* ===========================
   Initial render
   =========================== */
renderDashboard();
renderEmployeesShort();
populateInitialUIState();

/* small helper to wire UI state on load */
function populateInitialUIState(){
  // header
  document.getElementById('headerUser').innerText = 'Not signed in';
  // set theme selector
  const sel = document.getElementById('themeSelect');
  if(sel) sel.value = STORE.meta.theme || 'dark';
  // route home
  route('home');
}

/* ===========================
   End of Part 1 core file
   Next: Part 2 will add Employee Master UI + CRUD + file/attachments + robust password generation
   =========================== */

</script>
</body>
</html>
